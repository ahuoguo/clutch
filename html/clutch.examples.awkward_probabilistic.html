<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="resources/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="resources/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resources/config.js"></script>
<script type="text/javascript" src="resources/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">clutch.examples.awkward_probabilistic</h1>

<div class="code">
<span class="comment">(*<br/>
An&nbsp;example&nbsp;in&nbsp;Sec.&nbsp;6&nbsp;of&nbsp;https://cs.au.dk/~birke/papers/step-probability-conf.pdf<br/>
<br/>
Maybe&nbsp;this&nbsp;is&nbsp;another&nbsp;example,&nbsp;relying&nbsp;on&nbsp;local&nbsp;state&nbsp;encapsulation<br/>
&nbsp;&nbsp;tau&nbsp;=&nbsp;(1&nbsp;-&nbsp;&gt;&nbsp;1)&nbsp;-&gt;&nbsp;1<br/>
&nbsp;&nbsp;e1&nbsp;=&nbsp;let&nbsp;x&nbsp;=&nbsp;ref&nbsp;(flip&nbsp;())&nbsp;in&nbsp;\f.&nbsp;f();&nbsp;!x<br/>
&nbsp;&nbsp;e2&nbsp;=&nbsp;\f.&nbsp;f();&nbsp;flip()<br/>
show&nbsp;e1&nbsp;related&nbsp;to&nbsp;e2&nbsp;at&nbsp;tau.<br/>
<br/>
Or&nbsp;how&nbsp;about&nbsp;a&nbsp;variant&nbsp;of&nbsp;the&nbsp;above,&nbsp;but&nbsp;where&nbsp;e1&nbsp;is&nbsp;let&nbsp;x&nbsp;=&nbsp;ref&nbsp;(flip&nbsp;())&nbsp;in&nbsp;\f.&nbsp;(x&nbsp;:=&nbsp;negate&nbsp;(!x);&nbsp;f();&nbsp;!x).&nbsp;?<br/>
<br/>
NB:&nbsp;e1&nbsp;and&nbsp;e2&nbsp;are&nbsp;equivalent&nbsp;only&nbsp;if&nbsp;executed&nbsp;only&nbsp;once.&nbsp;We&nbsp;prove&nbsp;the<br/>
equivalence&nbsp;by&nbsp;adding&nbsp;a&nbsp;guard&nbsp;that&nbsp;returns&nbsp;`NONE`&nbsp;after&nbsp;the&nbsp;first&nbsp;invocation.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">clutch</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="clutch.clutch.html#"><span class="id" title="library">clutch</span></a> <a class="idref" href="clutch.lib.flip.html#"><span class="id" title="library">lib.flip</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">clutch.examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="clutch.examples.one_time_pad.html#"><span class="id" title="library">one_time_pad</span></a>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span> "Type*".<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="proofs" class="idref" href="#proofs"><span class="id" title="section">proofs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="clutchRGS0:2" class="idref" href="#clutchRGS0:2"><span class="id" title="binder">!</span></a><a id="clutchRGS0:2" class="idref" href="#clutchRGS0:2"><span class="id" title="binder">clutchRGS</span></a> <a id="clutchRGS0:2" class="idref" href="#clutchRGS0:2"><span class="id" title="binder">Σ</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="awkwardN" class="idref" href="#awkwardN"><span class="id" title="definition">awkwardN</span></a> := <span class="id" title="definition">nroot</span><span class="id" title="notation">.@</span>"awkward".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement_prob" class="idref" href="#refinement_prob"><span class="id" title="lemma">refinement_prob</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "α" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a><a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#SOME"><span class="id" title="abbreviation">SOME</span></a> (<a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "α") <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="clutch.prob_lang.notation.html#NONE"><span class="id" title="abbreviation">NONE</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a><a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.lib.flip.html#flip"><span class="id" title="definition">flip</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a><a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> "callable" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#SOME"><span class="id" title="abbreviation">SOME</span></a> (<a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x") <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'if:'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="clutch.prob_lang.notation.html#NONE"><span class="id" title="abbreviation">NONE</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a><a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_sum"><span class="id" title="definition">lrel_sum</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_unit"><span class="id" title="definition">lrel_unit</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_r</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.lib.flip.html#refines_couple_tape_flip"><span class="id" title="lemma">refines_couple_tape_flip</span></a> <span class="id" title="notation">with</span> "[$α]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "Hα /="...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">cl</span> <span class="id" title="keyword">as</span> "Hcl"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">cr</span> <span class="id" title="keyword">as</span> "Hcr"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">P</span> := ((<span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">b</span> <span class="id" title="notation">∗</span> <span class="id" title="var">α</span> <a class="idref" href="clutch.lib.flip.html#53eba80cc5527af8f74a0acfba2d9230"><span class="id" title="notation">↪</span></a><a class="idref" href="clutch.lib.flip.html#53eba80cc5527af8f74a0acfba2d9230"><span class="id" title="notation">B</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">b</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">cl</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">cr</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="notation">∨</span> <span class="id" title="var">cl</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">cr</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>))%<span class="id" title="var">I</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> <span class="id" title="var">P</span> <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iLeft</span> ; <span class="id" title="var">iFrame</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;[(Hx &amp; Hα &amp; Hcl &amp; Hcr) | (Hx &amp; Hcr)] &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">rel_load_l</span>... <span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>... <span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitR</span> "Hα Hx".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>. <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> =&gt; // ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>. <span class="id" title="var">rel_flipL_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>. <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.rel_logic.model.html#lrel_sum"><span class="id" title="definition">lrel_sum</span></a>, <a class="idref" href="clutch.rel_logic.model.html#lrel_car"><span class="id" title="projection">lrel_car</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="var">iExists</span> (<a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">b</span>). <span class="id" title="tactic">simpl</span>. <span class="id" title="var">iRight</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">rel_load_l</span>... <span class="id" title="var">rel_load_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.rel_logic.model.html#lrel_sum"><span class="id" title="definition">lrel_sum</span></a>/<a class="idref" href="clutch.rel_logic.model.html#lrel_car"><span class="id" title="projection">lrel_car</span></a>/=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>. <span class="id" title="var">iLeft</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Simplified&nbsp;warm-up&nbsp;for&nbsp;the&nbsp;next&nbsp;series&nbsp;of&nbsp;examples.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;reference&nbsp;to&nbsp;`x`&nbsp;is&nbsp;local&nbsp;to&nbsp;the&nbsp;rhs&nbsp;closure,&nbsp;we&nbsp;never&nbsp;need&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transfer&nbsp;its&nbsp;ownership&nbsp;into&nbsp;an&nbsp;invariant,&nbsp;and&nbsp;`f`&nbsp;cannot&nbsp;interfere&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;couple&nbsp;with&nbsp;`x`.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement_prob_resample_local_ref" class="idref" href="#refinement_prob_resample_local_ref"><span class="id" title="lemma">refinement_prob_resample_local_ref</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "α" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "α"<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x" <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> ; <span class="id" title="tactic">auto</span> ; <span class="id" title="var">iFrame</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "(β &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> =&gt; // ; [<span class="id" title="var">iApply</span> "Hf" =&gt; //|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;following&nbsp;is&nbsp;an&nbsp;example&nbsp;of&nbsp;a&nbsp;contextual&nbsp;equivalence&nbsp;we&nbsp;expect&nbsp;to&nbsp;hold<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;cannot&nbsp;currently&nbsp;prove&nbsp;conveniently&nbsp;using&nbsp;our&nbsp;relational&nbsp;logic.&nbsp;The<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;issue&nbsp;is&nbsp;that&nbsp;we&nbsp;cannot&nbsp;determine,&nbsp;ahead&nbsp;of&nbsp;time,&nbsp;which&nbsp;flip&nbsp;to&nbsp;couple<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;in&nbsp;the&nbsp;rhs.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One&nbsp;is&nbsp;tempted&nbsp;to&nbsp;argue&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;sufficient&nbsp;to&nbsp;find&nbsp;a&nbsp;coupling<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;for&nbsp;any&nbsp;given&nbsp;call&nbsp;to&nbsp;the&nbsp;lhs&nbsp;and&nbsp;rhs&nbsp;closures,&nbsp;and&nbsp;couple&nbsp;`α`&nbsp;and&nbsp;`γ`<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;presampling&nbsp;a&nbsp;new&nbsp;bit&nbsp;`xor&nbsp;b&nbsp;b'`&nbsp;to&nbsp;`α`&nbsp;and&nbsp;`b'`&nbsp;to&nbsp;`γ`.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;even&nbsp;though&nbsp;`x`&nbsp;is&nbsp;local&nbsp;to&nbsp;the&nbsp;rhs,&nbsp;we&nbsp;cannot&nbsp;argue&nbsp;the&nbsp;coupling&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`α`&nbsp;and&nbsp;`γ`&nbsp;will&nbsp;be&nbsp;propagated&nbsp;past&nbsp;`f`.&nbsp;The&nbsp;reason&nbsp;is&nbsp;that&nbsp;`f`&nbsp;may&nbsp;be<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instantiated&nbsp;with&nbsp;the&nbsp;a&nbsp;function&nbsp;calling&nbsp;the&nbsp;rhs,&nbsp;which&nbsp;would&nbsp;sample&nbsp;a&nbsp;new<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit&nbsp;to&nbsp;`γ`&nbsp;and&nbsp;modify&nbsp;`x`.&nbsp;Of&nbsp;course&nbsp;this&nbsp;shouldn't&nbsp;matter&nbsp;since&nbsp;for&nbsp;any<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;of&nbsp;`x`,&nbsp;there&nbsp;exists&nbsp;a&nbsp;coupling&nbsp;(via&nbsp;`xor&nbsp;!x`),&nbsp;but&nbsp;we&nbsp;cannot<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exploit&nbsp;this&nbsp;observation&nbsp;in&nbsp;the&nbsp;formal&nbsp;argument.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="call_flip" class="idref" href="#call_flip"><span class="id" title="definition">call_flip</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "α" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "α")%<span class="id" title="var">E</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store_xor" class="idref" href="#store_xor"><span class="id" title="definition">store_xor</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> (<a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a> "x") "b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">E</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store_xor_late" class="idref" href="#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> (<a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a> "x") "b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">E</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="store_ignore" class="idref" href="#store_ignore"><span class="id" title="definition">store_ignore</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "β" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#allocB"><span class="id" title="definition">allocB</span></a> <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> "b" <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.lib.flip.html#flipL"><span class="id" title="definition">flipL</span></a> "γ" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"b'" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">E</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;we&nbsp;try&nbsp;to&nbsp;do&nbsp;the&nbsp;proof&nbsp;directly&nbsp;with&nbsp;our&nbsp;bare&nbsp;hands&nbsp;we&nbsp;get&nbsp;stuck.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement_prob_resample" class="idref" href="#refinement_prob_resample"><span class="id" title="lemma">refinement_prob_resample</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a>... <span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:4" class="idref" href="#b:4"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:3"><span class="id" title="variable">b</span></a>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; xb ) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_r</span> <a class="idref" href="clutch.lib.flip.html#refines_flipL_empty_r"><span class="id" title="lemma">refines_flipL_empty_r</span></a> =&gt; // ; <span class="id" title="var">iFrame</span>. <span class="id" title="var">iIntros</span> "%b β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;lose.&nbsp;If&nbsp;we&nbsp;had&nbsp;prophecies,&nbsp;we&nbsp;could&nbsp;couple&nbsp;α&nbsp;and&nbsp;γ&nbsp;with&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;bijection&nbsp;(xor&nbsp;!x)&nbsp;at&nbsp;the&nbsp;time&nbsp;when&nbsp;the&nbsp;read&nbsp;from&nbsp;x&nbsp;occurs.&nbsp;Instead,&nbsp;we&nbsp;can<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;to&nbsp;couple&nbsp;with&nbsp;the&nbsp;current&nbsp;contents&nbsp;of&nbsp;x,&nbsp;i.e.&nbsp;b.&nbsp;But&nbsp;we&nbsp;can't&nbsp;hope<br/>
&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;this&nbsp;will&nbsp;be&nbsp;preserved,&nbsp;so&nbsp;we'll&nbsp;get&nbsp;stuck&nbsp;later&nbsp;on.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_r</span> (<a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">b</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">α</span> <span class="id" title="var">γ</span> ) =&gt; // ; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">b''</span>) "(γ &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -{2}(<span class="id" title="definition">cancel</span> (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">b</span>) (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">b</span>) <span class="id" title="var">b''</span>). <span class="id" title="tactic">set</span> (<span class="id" title="var">b'</span> := (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">b</span> <span class="id" title="var">b''</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_r</span>... <span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="tactic">by</span> <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; xb ) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> ; <span class="id" title="var">rel_load_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="tactic">by</span> <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">rel_apply_r</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.rel_rules.html#refines_steps_r"><span class="id" title="lemma">refines_steps_r</span></a> <span class="id" title="notation">$!</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.one_time_pad.html#xor_tp"><span class="id" title="lemma">xor_tp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><span class="id" title="notation">))</span> ; [<span class="id" title="var">easy</span>|<span class="id" title="var">iModIntro</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;do&nbsp;not&nbsp;know&nbsp;this,&nbsp;in&nbsp;fact&nbsp;it&nbsp;may&nbsp;well&nbsp;be&nbsp;false&nbsp;(i.e.&nbsp;read&nbsp;this&nbsp;as&nbsp;`assert&nbsp;False`).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">not_necessarily_b</span>) <span class="id" title="keyword">as</span> &lt;- <span class="id" title="tactic">by</span> <span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<span class="id" title="var">b'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">cancel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Abort</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Instead&nbsp;of&nbsp;directly&nbsp;trying&nbsp;to&nbsp;link&nbsp;the&nbsp;flip&nbsp;in&nbsp;call_flip&nbsp;with&nbsp;the&nbsp;one&nbsp;in<br/>
&nbsp;&nbsp;store_xor&nbsp;via&nbsp;`(xor&nbsp;!x)`,&nbsp;we&nbsp;prove&nbsp;that&nbsp;the&nbsp;flip&nbsp;on&nbsp;`γ`&nbsp;can&nbsp;be&nbsp;delayed&nbsp;after<br/>
&nbsp;&nbsp;the&nbsp;call&nbsp;to&nbsp;`f`.&nbsp;This&nbsp;will&nbsp;allow&nbsp;us&nbsp;to&nbsp;pick&nbsp;a&nbsp;coupling&nbsp;depending&nbsp;on&nbsp;the&nbsp;value<br/>
&nbsp;&nbsp;of&nbsp;`x`&nbsp;*after*&nbsp;the&nbsp;call&nbsp;to&nbsp;`f`&nbsp;in&nbsp;the&nbsp;next&nbsp;refinement.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="store_xor_late_store_xor" class="idref" href="#store_xor_late_store_xor"><span class="id" title="lemma">store_xor_late_store_xor</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"... <span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x'</span> <span class="id" title="keyword">as</span> "x'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:7" class="idref" href="#b:7"><span class="id" title="binder">b</span></a> <a id="b':8" class="idref" href="#b':8"><span class="id" title="binder">b'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:5"><span class="id" title="variable">b</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">x'</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b':6"><span class="id" title="variable">b'</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:5"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#b':6"><span class="id" title="variable">b'</span></a><span class="id" title="notation">⌝</span>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; %old_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "(β &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ'</span> <span class="id" title="keyword">as</span> "γ'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> (<a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">γ</span> <span class="id" title="var">γ'</span> ) =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(γ' &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; %not_necessarily_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> ; <span class="id" title="var">rel_load_r</span> ; <span class="id" title="var">rel_load_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">rel_apply_r</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.rel_rules.html#refines_steps_r"><span class="id" title="lemma">refines_steps_r</span></a> <span class="id" title="notation">$!</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.one_time_pad.html#xor_tp"><span class="id" title="lemma">xor_tp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><span class="id" title="notation">))</span> ; [<span class="id" title="var">easy</span>|<span class="id" title="var">iModIntro</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_l</span> (<a class="idref" href="clutch.rel_logic.rel_rules.html#refines_wp_l"><span class="id" title="lemma">refines_wp_l</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.program_logic.weakestpre.html#wp_mono"><span class="id" title="lemma">wp_mono</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor_wp"><span class="id" title="lemma">xor_wp</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "-&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="store_ignore_store_xor_late" class="idref" href="#store_ignore_store_xor_late"><span class="id" title="lemma">store_ignore_store_xor_late</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"... <span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x'</span> <span class="id" title="keyword">as</span> "x'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:11" class="idref" href="#b:11"><span class="id" title="binder">b</span></a> <a id="b':12" class="idref" href="#b':12"><span class="id" title="binder">b'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:9"><span class="id" title="variable">b</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">x'</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b':10"><span class="id" title="variable">b'</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:9"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#b':10"><span class="id" title="variable">b'</span></a><span class="id" title="notation">⌝</span>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; %old_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "(β &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ'</span> <span class="id" title="keyword">as</span> "γ'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; %not_necessarily_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> (<a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">not_necessarily_b</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">γ</span> <span class="id" title="var">γ'</span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(γ' &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> ; <span class="id" title="var">rel_load_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">rel_apply_r</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.rel_rules.html#refines_steps_r"><span class="id" title="lemma">refines_steps_r</span></a> <span class="id" title="notation">$!</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.one_time_pad.html#xor_tp"><span class="id" title="lemma">xor_tp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><span class="id" title="notation">))</span> ; [<span class="id" title="var">easy</span>|<span class="id" title="var">iModIntro</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">cancel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="call_flip_store_ignore" class="idref" href="#call_flip_store_ignore"><span class="id" title="lemma">call_flip_store_ignore</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:14" class="idref" href="#b:14"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:13"><span class="id" title="variable">b</span></a>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; xb) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_r</span> <a class="idref" href="clutch.lib.flip.html#refines_flipL_empty_r"><span class="id" title="lemma">refines_flipL_empty_r</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> "%b α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; xb) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(β &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_r</span> ; <span class="id" title="var">rel_flipL_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;opposite&nbsp;direction&nbsp;of&nbsp;the&nbsp;last&nbsp;three&nbsp;refinements.&nbsp;The&nbsp;proofs&nbsp;are<br/>
&nbsp;&nbsp;essentially&nbsp;the&nbsp;same.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="store_xor_store_xor_late" class="idref" href="#store_xor_store_xor_late"><span class="id" title="lemma">store_xor_store_xor_late</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"... <span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x'</span> <span class="id" title="keyword">as</span> "x'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:17" class="idref" href="#b:17"><span class="id" title="binder">b</span></a> <a id="b':18" class="idref" href="#b':18"><span class="id" title="binder">b'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:15"><span class="id" title="variable">b</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">x'</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b':16"><span class="id" title="variable">b'</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:15"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#b':16"><span class="id" title="variable">b'</span></a><span class="id" title="notation">⌝</span>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; %old_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "(β &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ'</span> <span class="id" title="keyword">as</span> "γ'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> (<a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">γ</span> <span class="id" title="var">γ'</span> ) =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(γ' &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; %not_necessarily_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> ; <span class="id" title="var">rel_load_r</span> ; <span class="id" title="var">rel_load_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">rel_apply_r</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.rel_rules.html#refines_steps_r"><span class="id" title="lemma">refines_steps_r</span></a> <span class="id" title="notation">$!</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.one_time_pad.html#xor_tp"><span class="id" title="lemma">xor_tp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><span class="id" title="notation">))</span> ; [<span class="id" title="var">easy</span>|<span class="id" title="var">iModIntro</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_l</span> (<a class="idref" href="clutch.rel_logic.rel_rules.html#refines_wp_l"><span class="id" title="lemma">refines_wp_l</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.program_logic.weakestpre.html#wp_mono"><span class="id" title="lemma">wp_mono</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor_wp"><span class="id" title="lemma">xor_wp</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "-&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="store_xor_late_store_ignore" class="idref" href="#store_xor_late_store_ignore"><span class="id" title="lemma">store_xor_late_store_ignore</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late"><span class="id" title="definition">store_xor_late</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"... <span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x'</span> <span class="id" title="keyword">as</span> "x'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:21" class="idref" href="#b:21"><span class="id" title="binder">b</span></a> <a id="b':22" class="idref" href="#b':22"><span class="id" title="binder">b'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:19"><span class="id" title="variable">b</span></a> <span class="id" title="notation">∗</span> <span class="id" title="var">x'</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b':20"><span class="id" title="variable">b'</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:19"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#b':20"><span class="id" title="variable">b'</span></a><span class="id" title="notation">⌝</span>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>,<span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; %old_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b</span>) "(β &amp; α)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">γ'</span> <span class="id" title="keyword">as</span> "γ'"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; %not_necessarily_b' &amp; xb &amp; xb' &amp; &lt;-) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> (<a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> (<a class="idref" href="clutch.examples.one_time_pad.html#xor_sem"><span class="id" title="definition">xor_sem</span></a> <span class="id" title="var">not_necessarily_b</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">γ</span> <span class="id" title="var">γ'</span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(γ' &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor"><span class="id" title="definition">xor</span></a> ; <span class="id" title="var">rel_load_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb xb'" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_l</span> (<a class="idref" href="clutch.rel_logic.rel_rules.html#refines_wp_l"><span class="id" title="lemma">refines_wp_l</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.program_logic.weakestpre.html#wp_mono"><span class="id" title="lemma">wp_mono</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id" title="var">wp_apply</span> <a class="idref" href="clutch.examples.one_time_pad.html#xor_wp"><span class="id" title="lemma">xor_wp</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "-&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="store_ignore_call_flip" class="idref" href="#store_ignore_call_flip"><span class="id" title="lemma">store_ignore_call_flip</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">REL</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">&lt;&lt;</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> <a class="idref" href="clutch.rel_logic.model.html#:::'REL'_x_'&lt;&lt;'_x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#lrel_bool"><span class="id" title="definition">lrel_bool</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_l</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">rel_pures_r</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">foldxor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore"><span class="id" title="definition">store_ignore</span></a> /<a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "x"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="notation">∃</span> <a id="b:24" class="idref" href="#b:24"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><span class="id" title="notation">,</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.examples.awkward_probabilistic.html#b:23"><span class="id" title="variable">b</span></a>) <a class="idref" href="clutch.examples.awkward_probabilistic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow_val"><span class="id" title="lemma">refines_arrow_val</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> "α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_r</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> "β"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span> ; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%old_b &amp; xb) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply_l</span> <a class="idref" href="clutch.lib.flip.html#refines_flipL_empty_l"><span class="id" title="lemma">refines_flipL_empty_l</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> "%b α"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_allocBtape_l</span> <span class="id" title="var">γ</span> <span class="id" title="keyword">as</span> "γ"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span> ; [<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hf"|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[-$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;(%not_necessarily_b &amp; xb) &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_apply</span> <a class="idref" href="clutch.lib.flip.html#refines_couple_bool_tape_tape"><span class="id" title="lemma">refines_couple_bool_tape_tape</span></a> =&gt; // ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iIntros</span> (<span class="id" title="var">b'</span>) "(β &amp; γ)" =&gt; /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_flipL_l</span> ; <span class="id" title="var">rel_flipL_r</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span> ; <span class="id" title="var">iSplitL</span> "xb" ; [ <span class="id" title="var">iExists</span> <span class="id" title="var">_</span> ; <span class="id" title="var">iFrame</span> ; <span class="id" title="var">done</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="clutch.examples.awkward_probabilistic.html#proofs"><span class="id" title="section">proofs</span></a>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="store_xor_call_flip_refinement" class="idref" href="#store_xor_call_flip_refinement"><span class="id" title="lemma">store_xor_call_flip_refinement</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">∅</span> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">⊨</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">≤</span></a><a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">ctx</span></a><a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">≤</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.typing.types.html#2599395bdcdbb2edbbcec60bbf1ebff1"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.typing.types.html#2599395bdcdbb2edbbcec60bbf1ebff1"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.typing.types.html#TBool"><span class="id" title="constructor">TBool</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="clutch.typing.contextual_refinement.html#ctx_refines_transitive"><span class="id" title="instance">ctx_refines_transitive</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_store_xor_late"><span class="id" title="lemma">store_xor_store_xor_late</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="clutch.typing.contextual_refinement.html#ctx_refines_transitive"><span class="id" title="instance">ctx_refines_transitive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late_store_ignore"><span class="id" title="lemma">store_xor_late_store_ignore</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore_call_flip"><span class="id" title="lemma">store_ignore_call_flip</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="call_flip_store_xor_refinement" class="idref" href="#call_flip_store_xor_refinement"><span class="id" title="lemma">call_flip_store_xor_refinement</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">∅</span> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">⊨</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip"><span class="id" title="definition">call_flip</span></a> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">≤</span></a><a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">ctx</span></a><a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">≤</span></a> <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor"><span class="id" title="definition">store_xor</span></a> <a class="idref" href="clutch.typing.contextual_refinement.html#148b4953c94aeab737ed5dd794040d7d"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.typing.types.html#2599395bdcdbb2edbbcec60bbf1ebff1"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.typing.types.html#2599395bdcdbb2edbbcec60bbf1ebff1"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.typing.types.html#cf2aa254e4c9f9cb95db860c4555acd5"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.typing.types.html#TBool"><span class="id" title="constructor">TBool</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="clutch.typing.contextual_refinement.html#ctx_refines_transitive"><span class="id" title="instance">ctx_refines_transitive</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#call_flip_store_ignore"><span class="id" title="lemma">call_flip_store_ignore</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="clutch.typing.contextual_refinement.html#ctx_refines_transitive"><span class="id" title="instance">ctx_refines_transitive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_ignore_store_xor_late"><span class="id" title="lemma">store_ignore_store_xor_late</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> (<a class="idref" href="clutch.typing.soundness.html#refines_sound"><span class="id" title="lemma">refines_sound</span></a> <a class="idref" href="clutch.rel_logic.adequacy_rel.html#6eff3dc174695f5fd55570d85c334262"><span class="id" title="definition">clutchRΣ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span>: <a class="idref" href="clutch.examples.awkward_probabilistic.html#store_xor_late_store_xor"><span class="id" title="lemma">store_xor_late_store_xor</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/coq-community/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
