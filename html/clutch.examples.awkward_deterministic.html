<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="resources/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="resources/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resources/config.js"></script>
<script type="text/javascript" src="resources/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">clutch.examples.awkward_deterministic</h1>

<div class="code">
<span class="comment">(*&nbsp;Pitts&nbsp;&amp;&nbsp;Stark's&nbsp;awkward&nbsp;example,&nbsp;following&nbsp;the&nbsp;ReLoC&nbsp;formalisation.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.algebra</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">csum</span> <span class="id" title="library">excl</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">clutch</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="clutch.clutch.html#"><span class="id" title="library">clutch</span></a>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span> "Type*".<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="oneshotR" class="idref" href="#oneshotR"><span class="id" title="definition">oneshotR</span></a> := <span class="id" title="definition">csumR</span> (<span class="id" title="definition">exclR</span> <span class="id" title="definition">unitR</span>) (<span class="id" title="definition">agreeR</span> <span class="id" title="definition">unitR</span>).<br/>
<span class="id" title="keyword">Class</span> <a id="oneshotG" class="idref" href="#oneshotG"><span class="id" title="record">oneshotG</span></a> <a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder">Σ</span></a> := { <a id="oneshot_inG" class="idref" href="#oneshot_inG"><span class="id" title="projection">oneshot_inG</span></a> :&gt; <span class="id" title="class">inG</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#oneshotR"><span class="id" title="definition">oneshotR</span></a> }.<br/>
<span class="id" title="keyword">Definition</span> <a id="28971e5052860be4f393425b9e0d20fc" class="idref" href="#28971e5052860be4f393425b9e0d20fc"><span class="id" title="definition">oneshotΣ</span></a> : <span class="id" title="record">gFunctors</span> := <span class="id" title="notation">#[</span><span class="id" title="constructor">GFunctor</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#oneshotR"><span class="id" title="definition">oneshotR</span></a><span class="id" title="notation">]</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <a id="d19ad2c8f64fcbbe26efa3a76f9132e2" class="idref" href="#d19ad2c8f64fcbbe26efa3a76f9132e2"><span class="id" title="instance">subG_oneshotΣ</span></a> {<a id="9c6d78f4cdf6dede5e109a175164bdaa" class="idref" href="#9c6d78f4cdf6dede5e109a175164bdaa"><span class="id" title="binder">Σ</span></a>} : <span class="id" title="class">subG</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#28971e5052860be4f393425b9e0d20fc"><span class="id" title="definition">oneshotΣ</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#9c6d78f4cdf6dede5e109a175164bdaa"><span class="id" title="variable">Σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#oneshotG"><span class="id" title="class">oneshotG</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#9c6d78f4cdf6dede5e109a175164bdaa"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">solve_inG</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="proofs" class="idref" href="#proofs"><span class="id" title="section">proofs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="clutchRGS0:6" class="idref" href="#clutchRGS0:6"><span class="id" title="binder">!</span></a><a id="clutchRGS0:6" class="idref" href="#clutchRGS0:6"><span class="id" title="binder">clutchRGS</span></a> <a id="clutchRGS0:6" class="idref" href="#clutchRGS0:6"><span class="id" title="binder">Σ</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="awkwardN" class="idref" href="#awkwardN"><span class="id" title="definition">awkwardN</span></a> := <span class="id" title="definition">nroot</span><span class="id" title="notation">.@</span>"awkward".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement1" class="idref" href="#refinement1"><span class="id" title="lemma">refinement1</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">REL</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1 <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x"<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a><a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">≾</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_int"><span class="id" title="definition">lrel_int</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> (<span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1)%<span class="id" title="var">I</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#awkwardN"><span class="id" title="definition">awkwardN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> =&gt; //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_pures_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_arrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hff".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_rec_l</span>. <span class="id" title="var">rel_rec_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hff]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.compatibility.html#refines_app"><span class="id" title="lemma">refines_app</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[Hx Hclose]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[- $Hclose $Hx]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="pending" class="idref" href="#pending"><span class="id" title="definition">pending</span></a> <a id="aeda8cee5984920a58fbaa1ad4bc0b11" class="idref" href="#aeda8cee5984920a58fbaa1ad4bc0b11"><span class="id" title="binder">γ</span></a> `{<a id="H:8" class="idref" href="#H:8"><span class="id" title="binder">oneshotG</span></a> <a id="H:8" class="idref" href="#H:8"><span class="id" title="binder">Σ</span></a>} := <span class="id" title="definition">own</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#aeda8cee5984920a58fbaa1ad4bc0b11"><span class="id" title="variable">γ</span></a> (<span class="id" title="constructor">Cinl</span> (<span class="id" title="constructor">Excl</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Program.Syntax.html#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">()</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="shot" class="idref" href="#shot"><span class="id" title="definition">shot</span></a> <a id="5c1067a9563b8bae1f4dc2a409ccba8f" class="idref" href="#5c1067a9563b8bae1f4dc2a409ccba8f"><span class="id" title="binder">γ</span></a> `{<a id="H:10" class="idref" href="#H:10"><span class="id" title="binder">oneshotG</span></a> <a id="H:10" class="idref" href="#H:10"><span class="id" title="binder">Σ</span></a>} := <span class="id" title="definition">own</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#5c1067a9563b8bae1f4dc2a409ccba8f"><span class="id" title="variable">γ</span></a> (<span class="id" title="constructor">Cinr</span> (<span class="id" title="definition">to_agree</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Program.Syntax.html#f5cb26d96fc0400fc3c881290947e554"><span class="id" title="notation">()</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="new_pending" class="idref" href="#new_pending"><span class="id" title="lemma">new_pending</span></a> `{<a id="H:11" class="idref" href="#H:11"><span class="id" title="binder">oneshotG</span></a> <a id="H:11" class="idref" href="#H:11"><span class="id" title="binder">Σ</span></a>} : <span class="id" title="notation">⊢</span> <span class="id" title="notation">|==&gt;</span> <span class="id" title="notation">∃</span> <a id="298f87735ca7ea8f69797e1ce2656a47" class="idref" href="#298f87735ca7ea8f69797e1ce2656a47"><span class="id" title="binder">γ</span></a><span class="id" title="notation">,</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#pending"><span class="id" title="definition">pending</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#298f87735ca7ea8f69797e1ce2656a47"><span class="id" title="variable">γ</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">own_alloc</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="shoot" class="idref" href="#shoot"><span class="id" title="lemma">shoot</span></a> <a id="4f26856a24270e77f960c01c9cfcd453" class="idref" href="#4f26856a24270e77f960c01c9cfcd453"><span class="id" title="binder">γ</span></a> `{<a id="H:14" class="idref" href="#H:14"><span class="id" title="binder">oneshotG</span></a> <a id="H:14" class="idref" href="#H:14"><span class="id" title="binder">Σ</span></a>} : <a class="idref" href="clutch.examples.awkward_deterministic.html#pending"><span class="id" title="definition">pending</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#4f26856a24270e77f960c01c9cfcd453"><span class="id" title="variable">γ</span></a> <span class="id" title="notation">==∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#shot"><span class="id" title="definition">shot</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#4f26856a24270e77f960c01c9cfcd453"><span class="id" title="variable">γ</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">own_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> [<span class="id" title="var">f</span> |]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">f</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="shootN" class="idref" href="#shootN"><span class="id" title="definition">shootN</span></a> := <span class="id" title="definition">nroot</span> <span class="id" title="notation">.@</span> "shootN".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="shot_not_pending" class="idref" href="#shot_not_pending"><span class="id" title="lemma">shot_not_pending</span></a> <a id="647837e7d5f02beaa110d2a69bde1630" class="idref" href="#647837e7d5f02beaa110d2a69bde1630"><span class="id" title="binder">γ</span></a> `{<a id="H:16" class="idref" href="#H:16"><span class="id" title="binder">oneshotG</span></a> <a id="H:16" class="idref" href="#H:16"><span class="id" title="binder">Σ</span></a>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.examples.awkward_deterministic.html#shot"><span class="id" title="definition">shot</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#647837e7d5f02beaa110d2a69bde1630"><span class="id" title="variable">γ</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#pending"><span class="id" title="definition">pending</span></a> <a class="idref" href="clutch.examples.awkward_deterministic.html#647837e7d5f02beaa110d2a69bde1630"><span class="id" title="variable">γ</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">False</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hs Hp".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iPoseProof</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_valid_2</span> <span class="id" title="notation">with</span> "Hs Hp"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "H".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "H" <span class="id" title="keyword">as</span> %[].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement2" class="idref" href="#refinement2"><span class="id" title="lemma">refinement2</span></a> `{<a id="H:17" class="idref" href="#H:17"><span class="id" title="binder">oneshotG</span></a> <a id="H:17" class="idref" href="#H:17"><span class="id" title="binder">Σ</span></a>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">REL</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>0 <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1<a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x"<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a><a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">≾</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1 <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x"<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_int"><span class="id" title="definition">lrel_int</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_l</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">y</span> <span class="id" title="keyword">as</span> "Hy".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_l</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#new_pending"><span class="id" title="lemma">new_pending</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">γ</span>) "Ht".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">P</span> := (<span class="id" title="notation">(</span><span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>0 <span class="id" title="notation">∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#pending"><span class="id" title="definition">pending</span></a> <span class="id" title="var">γ</span> <span class="id" title="notation">∨</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.primitive_laws.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1 <span class="id" title="notation">∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#shot"><span class="id" title="definition">shot</span></a> <span class="id" title="var">γ</span><span class="id" title="notation">)</span> <span class="id" title="notation">∗</span> <span class="id" title="var">y</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1)%<span class="id" title="var">I</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> <span class="id" title="var">P</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#shootN"><span class="id" title="definition">shootN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iLeft</span> ; <span class="id" title="var">iFrame</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow"><span class="id" title="lemma">refines_arrow</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(HP &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_let_l</span>. <span class="id" title="var">rel_let_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "HP" <span class="id" title="keyword">as</span> "([(Hx &amp; Hp) | (Hx &amp; #Hs)] &amp; Hy)" ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_l</span> ; <span class="id" title="var">rel_pures_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shoot"><span class="id" title="lemma">shoot</span></a> <span class="id" title="var">γ</span> <span class="id" title="notation">with</span> "Hp"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#Hs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span>. { <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_app"><span class="id" title="lemma">refines_app</span></a> <span class="id" title="notation">with</span> "Hf"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "([[[Hx &gt;Hp] | [Hx Hs']] Hy] &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iExFalso</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shot_not_pending"><span class="id" title="lemma">shot_not_pending</span></a> <span class="id" title="notation">with</span> "Hs Hp"<span class="id" title="notation">)</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_app"><span class="id" title="lemma">refines_app</span></a> <span class="id" title="notation">with</span> "Hf"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "([[[Hx &gt;Hp] | [Hx Hs']] Hy] &amp; Hclose)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iExFalso</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shot_not_pending"><span class="id" title="lemma">shot_not_pending</span></a> <span class="id" title="notation">with</span> "Hs Hp"<span class="id" title="notation">)</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="refinement25" class="idref" href="#refinement25"><span class="id" title="lemma">refinement25</span></a> `{<a id="H:18" class="idref" href="#H:18"><span class="id" title="binder">oneshotG</span></a> <a id="H:18" class="idref" href="#H:18"><span class="id" title="binder">Σ</span></a>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">REL</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">≾</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:'ref'_x"><span class="id" title="notation">ref</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>0 <a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">λ</span></a><a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">:</span></a> "f"<a class="idref" href="clutch.prob_lang.notation.html#d2c3354f6c46df814e66d4c5c9b9c738"><span class="id" title="notation">,</span></a> "x" <a class="idref" href="clutch.prob_lang.notation.html#::expr_scope:x_'&lt;-'_x"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1<a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> "f" <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="clutch.prob_lang.notation.html#3127c6bc552ca21a494fc6e3474a507d"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.prob_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a> <a class="idref" href="clutch.prob_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"x"<a class="idref" href="clutch.prob_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">)</span></a><a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="clutch.rel_logic.model.html#e0a731efa6662a1a7aedffb1e1ed7018"><span class="id" title="notation">:</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">(</span></a><a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#0926557fff3a7c5de6f38fcac599a96f"><span class="id" title="notation">()</span></a><a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">)</span></a> <a class="idref" href="clutch.rel_logic.model.html#198b3df6111d1e335bfbd02615def5fc"><span class="id" title="notation">→</span></a> <a class="idref" href="clutch.rel_logic.model.html#lrel_int"><span class="id" title="definition">lrel_int</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_alloc_r</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> "Hx".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#new_pending"><span class="id" title="lemma">new_pending</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">γ</span>) "Ht".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">P</span> := ((<span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>0 <span class="id" title="notation">∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#pending"><span class="id" title="definition">pending</span></a> <span class="id" title="var">γ</span> <span class="id" title="notation">∨</span> <span class="id" title="var">x</span> <a class="idref" href="clutch.rel_logic.spec_ra.html#0326014f985dcbdf069e6962e826748b"><span class="id" title="notation">↦ₛ</span></a> <a class="idref" href="clutch.prob_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1 <span class="id" title="notation">∗</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#shot"><span class="id" title="definition">shot</span></a> <span class="id" title="var">γ</span>))%<span class="id" title="var">I</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="clutch.rel_logic.model.html#refines_na_alloc"><span class="id" title="lemma">refines_na_alloc</span></a> <span class="id" title="var">P</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#shootN"><span class="id" title="definition">shootN</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplitL</span> ; [ <span class="id" title="var">iFrame</span> ; <span class="id" title="var">iLeft</span> ; <span class="id" title="var">iFrame</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hinv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_pure_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="clutch.rel_logic.rel_rules.html#refines_arrow"><span class="id" title="lemma">refines_arrow</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!#" (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span>) "#Hf".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_l</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(&gt;[[Hx Hp] | [Hx #Hs]] &amp; Hclose)" ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_store_r</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">rel_pure_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shoot"><span class="id" title="lemma">shoot</span></a> <span class="id" title="var">γ</span> <span class="id" title="notation">with</span> "Hp"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#Hs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_app"><span class="id" title="lemma">refines_app</span></a> <span class="id" title="notation">with</span> "Hf"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[[[&gt;Hx &gt;Hp] | [&gt;Hx _]] Hclose]";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iExFalso</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shot_not_pending"><span class="id" title="lemma">shot_not_pending</span></a> <span class="id" title="notation">with</span> "Hs Hp"<span class="id" title="notation">)</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_seq"><span class="id" title="lemma">refines_seq</span></a> <span class="id" title="notation">with</span> "[Hf]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.compatibility.html#refines_app"><span class="id" title="lemma">refines_app</span></a> <span class="id" title="notation">with</span> "Hf"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_inv"><span class="id" title="lemma">refines_na_inv</span></a> <span class="id" title="notation">with</span> "[$Hinv]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[[[&gt;Hx &gt;Hp] | [&gt;Hx _]] Hclose]";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_load_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iExFalso</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.examples.awkward_deterministic.html#shot_not_pending"><span class="id" title="lemma">shot_not_pending</span></a> <span class="id" title="notation">with</span> "Hs Hp"<span class="id" title="notation">)</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="clutch.rel_logic.model.html#refines_na_close"><span class="id" title="lemma">refines_na_close</span></a> <span class="id" title="notation">with</span> "[-$Hclose]"<span class="id" title="notation">)</span>. <span class="id" title="var">iSplitL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iRight</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rel_values</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="clutch.examples.awkward_deterministic.html#proofs"><span class="id" title="section">proofs</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/coq-community/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
